# Git 브랜치

모든 Git 저장소는 마스터 브랜치로 시작한다.

master는 Git이 기본으로 부여하는 이름이며, 기술적으로는 다른 브랜치와 같다.

다만 관례상으로 저장소에 저장된 프로젝트의 주된 안정 버전 역할을 한다.

(팀원은 각자의 마스터 브랜치를 수시로 사용하게 될 거란 뜻이다.)

기억해야 할 한 가지는 master는 가장 처음으로 작업하게 될 브랜치라는 점이다.

마지막 브랜치는 아니어도 된다.

> git branch # 현재 로컬 저장소에 있는 브랜치 목록

```
* master
(별표는 현재 브랜치로 설정돼 있음을 의미함)
```

브랜치는 결국 커밋들의 스택이며, 맨 위에 있는 커밋 또는 헤드 커밋을 나무에 비유하여 tip이라고도 한다.

스택은 헤드 커밋을 시작으로 연속된 부모 커밋으로 이뤄져 있으며,

Git이 따라 들어갈 수 있는 마지막은 저장소의 첫 번째 커밋이다.

---

마스터와 구별되는 별도의 브랜치를 작업(working) 브랜치 또는 토픽 브랜치라고 한다.

> git branch new-homepage # 현재 사용자가 위치해 있는 마지막 커밋을 시작점으로 한다.
> 
> ( 현재 master가 checkout돼 있음 ) 

브랜치 체크아웃은 두 가지 일을 한다.

1. 작업 사본을 그 브랜치의 헤드 커밋 상태에 맞춘다.
2. 그 브랜치를 현재 브랜치로 설정함으로써 이후의 모든 새로운 커밋이 그 브랜치에 추가되도록 한다.

> git checkout new-homepage
> 
> or git checkout -b new-homepage # 브랜치 생성 후 바로 이동
```
Switched to branch 'new-homepage'
```

> git branch
```
  master
* new-homepage
```
현 시점에서 두 브랜치는 이름만 다르고 완전히 동일한 커밋을 가리킨ㄷ.

두 브랜치는 직관적으로는 동일하나 논리적으로는 별개다.

내용이 같다 하더라도, ㅎ나의 사본에 이름이 두 개인 것이 아니라 서로 다른 논리적 사본이 두 개인 것.

---

* screen.css에 background-color 추가
> git commit -am "Change background color to orange"

```
[new-homepage 81e0b07] Change background color to orange
 2 files changed, 1 insertion(+), 244 deletions(-)
 delete mode 100644 2020-07-24.md
```

---

## 병합
> git checkout master
```
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
```
> git merge new-homepage

```
Updating bebb801..81e0b07
Fast-forward
 2020-07-24.md  | 244 --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 css/screen.css |   1 +
 2 files changed, 1 insertion(+), 244 
```

현재 브랜치에 다른 브랜치의 모든 사항을 포함해 완료하고 싶다면 두 가지 조건이 필요하다.

1. 다른 브랜치에서 만든 커밋이 비록 순서 변동이 있을지라도 커밋 로그에서 모두 보여야 한다.

    기본적으로는 현재 위치까지 오게 한 히스토리가 필요하며, 지금까지의 모든 작업을 포함하는 게보를 두 브랜치를 통해

    거슬러 올라갈 수 있어야 한다.

2. 두 브랜치의 모든 변경 사항이 결합된 프로젝트 파일과 폴더 사본이 최종적으로 필요하다.
   
   병합한 이후의 커밋도 예외는 아니어서, 어떤 것(=Git)이 새롭게 통합된 프로젝트 버전을 구성하는 책임을 져야 한다.

### 패스트 포워드

위 경우처럼 master 브랜치의 마지막 커밋 이후에 추가되면,

git merge는 병합 이후 프로젝트 상태를 파악하기 위한 어떤 일도 할 필요가 없다.

git이 할 일은 마스터 브랜치의 북마크를 현재 커밋에서 다른 브랜치의 헤드 커밋으로 이동시키는 것뿐.

### 병합 커밋
패스트 포워드는 보통은 드문 일이다.

프로젝트의 조합된 상태가 어떻게 보여야 하는지 파악하고, 새로운 병합된 버전을 나타낼 스냅샷을 만들며,

마지막으로 **병합 커밋**이라는 특별한 커밋을 추가해 모든 것을 함께 묶는다.

두 브랜치 모두 변경 사항이 있는 경우, 안전하게 병합됨을 보장하기 위해 Git은 약간 작업을 해야 한다.

먼저 두 버전의 가장 최근 공통 조상을 찾아 각 브랜치의 헤드 커밋의 변경 여부를 식별하고,

이를 기준점으로 삼아 변경된 내용과 순서를 파악한다.

그런 다음 두 브랜치의 각자 변경된 내용을 기준점 내용과 비교한다. 만약 둘 중 한 브랜치에 변경된 한 라인이 있다면,

그 줄은 최종 병합 사본으로의 포함을 위해 이전된다.

두 브랜치가 같은 라인에 대한 각자의 변경 사항을 갖고 있지 않는 한, Git은 모든 사항을 자동으로 병합한다.

### 병합 충돌

수작업도 OK.